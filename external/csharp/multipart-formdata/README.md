### Info

directory contains fixed and cleaned up code from [article](https://www.codeproject.com/Articles/8600/UploadFileEx-C-s-WebClient-UploadFile-with-more-fu)

### Testing

### Note

incorrectly building the payload, e.g. forgetting the `--` at the end,

```c#
byte[] boundaryBytes = Encoding.ASCII.GetBytes("\r\n--" + boundary + "--\r\n");
```
will lead to
```sh
2021-10-29 00:29:09.173 ERROR 8088 --- [nio-8085-exec-5] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : 
Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.web.multipart.MultipartException: 
Failed to parse multipart servlet request; nested exception is java.io.IOException: org.apache.tomcat.util.http.fileupload.FileUploadException: Stream ended unexpectedly] with root causeorg.apache.tomcat.util.http.fileupload.MultipartStream$MalformedStreamException: Stream ended unexpectedly
```
this is recognized by the sender as
```text
Failed to post data : The remote server returned an error: (500) Internal Server Error.
```
Other errors are:
server side:
```text
ExceptionResolver : Resolved [org.springframework.web.multipart.support.MissingServletRequestPartException: Required request part 'file' is not present]
```
client side:
```text
Failed to post data : The remote server returned an error: (400) Bad Request.
```
when there is a syntax error in `Content-Disposition` message:
```text
Content-Disposition: form-data; name="file" filename="data.txt"
```
instead of
```text
Content-Disposition: form-data; name="file"; filename="data.txt"
```
(exception is caught and processed by the server)
and
```text
Failed to post data : The remote server returned an error: (405) Method Not Allowed.
```
when the query string does not have `operation=send` - the __HTTP status 405__ (`HttpStatus.METHOD_NOT_ALLOWED`) is generated by server

### WMI and Performance Counters

  * [Manually rebuild performance counter library values](https://docs.microsoft.com/en-US/troubleshoot/windows-server/performance/rebuild-performance-counter-library-values)
  * `\\System\\Processor Queue Length` performance counter not working [post](https://docs.microsoft.com/en-us/answers/questions/702384/systemprocessor-queue-length-performance-counter-n.html)
  * `typeperf.exe` [documentation](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/typeperf)
  * [Set up Performance Counters in Windows Performance Monitor](https://docs.microsoft.com/en-us/dynamics365/business-central/dev-itpro/administration/set-up-performance-counters-performance-monitor)
  * https://serverfault.com/questions/339282/how-can-i-save-the-counters-setup-in-windows-performance-monitor
### See Also

  * https://www.codeproject.com/Articles/17449/Send-a-content-type-multipart-form-data-request-fr
  * https://www.codeproject.com/Articles/2359/File-Upload-using-a-VBScript-Class
  * custom adapter enforcing arguments [example](https://www.codeproject.com/Articles/5318610/One-More-Solution-to-Calling-PowerShell-from-Cshar) - see `Utils/PowershellCommandAdapter.cs`
  
### Author
[Serguei Kouzmine](kouzmine_serguei@yahoo.com)
